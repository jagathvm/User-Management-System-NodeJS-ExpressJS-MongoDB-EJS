<div class="d-flex justify-content-between align-items-center flex-wrap flex-md-nowrap pt-3 pb-2 mb-3 border-bottom">
  <h1 class="h1">
    <%= user.firstName %>
  </h1>
</div>

<div class="col py-3">
  <div class="row">
    <div class="col">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="/api/admin/dashboard">Dashboard</a></li>
          <li class="breadcrumb-item active">
            <%= user.username %>
          </li>
        </ol>
      </nav>
    </div>
    <div class="col text-end fw-lighter">
      <b>UserId: </b> <%= user._id %>
    </div>
  </div>
</div>

<ul class="list-group mb-3">
  <li class="list-group-item">
    <div class="row">
      <div class="col" style="max-width: 140px;"><b>Username:</b></div>
      <div class="col">
        <%= user.username %>
      </div>
    </div>
  </li>
  <li class="list-group-item">
    <div class="row">
      <div class="col" style="max-width: 140px;"><b>Email:</b></div>
      <div class="col">
        <%= user.email %>
      </div>
    </div>
  </li>
  <li class="list-group-item">
    <div class="row">
      <div class="col" style="max-width: 140px;"><b>Telephone:</b></div>
      <div class="col">
        <%= user.tel %>
      </div>
    </div>
  </li>
  <li class="list-group-item">
    <div class="row">
      <div class="col" style="max-width: 140px;"><b>Role:</b></div>
      <div class="col">
        <%= user.role.name %>
      </div>
    </div>
  </li>
  <li class="list-group-item">
    <div class="row">
      <div class="col" style="max-width: 140px;"><b>Status:</b></div>
      <div class="col">
        <%= user.accountStatus.isActive ? "ACTIVE" : "INACTIVE"  %>
      </div>
    </div>
  </li>
  <li class="list-group-item">
    <div class="row">
      <div class="col" style="max-width: 140px;"><b>Created At:</b></div>
      <div class="col">
        <%= user.accountStatus.createdAt || "N/A" %>
      </div>
    </div>
  </li>
  <li class="list-group-item">
    <div class="row">
      <div class="col" style="max-width: 140px;"><b>Updated At:</b></div>
      <div class="col">
        <%= user.accountStatus.updatedAt || "N/A" %>
      </div>
    </div>
  </li>
  <li class="list-group-item">
    <div class="row">
      <div class="col" style="max-width: 140px;"><b>Last Login:</b></div>
      <div class="col">
        <%= user.accountStatus.lastLogin || "N/A" %>
      </div>
    </div>
  </li>

</ul>

<div class="d-flex justify-content-end gap-2">
  <!-- Edit User Button -->
  <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#editUserModal">
    Edit User Details
  </button>
  <!-- Block/Unblock User Button -->
  <button type="button" class="<%= user.accountStatus.isBlocked ? 'btn btn-success' : 'btn btn-warning' %>" data-bs-toggle="modal" data-bs-target="#blockUserModal">
    <%= user.accountStatus.isBlocked ? "Unblock User" : "Block User" %>
  </button>
  <!-- Delete User Button -->
  <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteUserModal">
    Delete User
  </button>
</div>

<!-- Edit User Modal -->
<div class="modal fade" id="editUserModal" tabindex="-1" aria-labelledby="editUserModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form id="updateUserForm">
        <div class="modal-header">
          <h5 class="modal-title" id="editUserModalLabel">Edit User Details</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label for="username" class="form-label">Username</label>
            <input type="text" class="form-control" id="username" name="username" value="<%= user.username %>" required>
          </div>
          <div class="mb-3">
            <label for="email" class="form-label">Email</label>
            <input type="email" class="form-control" id="email" name="email" value="<%= user.email %>" required>
          </div>
          <div class="mb-3">
            <label for="tel" class="form-label">Telephone</label>
            <input type="tel" class="form-control" id="tel" name="tel" value="<%= user.tel %>" required>
          </div>
          <div class="mb-3">
            <label for="role" class="form-label">Role</label>
            <select class="form-control" id="role" name="role">
              <option value="ADMIN" <%= user.role.id === 1 ? 'selected' : '' %>>ADMIN</option>
              <option value="USER" <%= user.role.id === 2 ? 'selected' : '' %>>USER</option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Save Changes</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Block/Unblock User Modal -->
<div class="modal fade" id="blockUserModal" tabindex="-1" aria-labelledby="blockUserModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form id="blockUserForm">
        <div class="modal-header">
          <h5 class="modal-title" id="blockUserModalLabel">Block/Unblock User</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p>Are you sure you want to <strong><%= user.accountStatus.isBlocked ? 'unblock' : 'block' %></strong> user <strong><%= user.username %></strong>? This action cannot be undone.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="<%= user.accountStatus.isBlocked ? 'btn btn-success' : 'btn btn-warning' %>"><%= user.accountStatus.isBlocked ? 'Unblock User' : 'Block User' %></button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Delete User Modal -->
<div class="modal fade" id="deleteUserModal" tabindex="-1" aria-labelledby="deleteUserModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form id="deleteUserForm">
        <div class="modal-header">
          <h5 class="modal-title" id="deleteUserModalLabel">Delete User</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p>Are you sure you want to delete user <b><%= user.username %></b>? This action cannot be undone.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-danger">Delete</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script type="module" src="/scripts/user/editUser.js"></script>
